<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>镜花水月模拟器 - 2556x1179 版</title>
    <style>
        @font-face {
            font-family: 'MyCustomFont';
            src: url('fonts/myfont.ttf') format('truetype');
        }

        :root { --gold: #ffcc00; }

        body {
            margin: 0; padding: 0; background: #1a1a1a;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
            font-family: 'MyCustomFont', "Microsoft YaHei", sans-serif;
            color: white;
        }

        /* --- 大小控制：画布比例修改 --- */
        #game-stage {
            width: 2556px;  /* 宽度修改 */
            height: 1179px; /* 高度修改 */
            background: url('images/BG1.png') center/cover no-repeat #000;
            position: relative;
            flex-shrink: 0; /* 防止被压缩 */
            transition: background-image 0.5s ease;
        }

        /* 自动缩放逻辑：让大页面在小屏幕也能看全 */
        @media (max-width: 2556px), (max-height: 1179px) {
            #game-stage {
                transform: scale(0.5); /* 你可以根据需要调整这个初始缩放比例 */
            }
        }

        #game-stage.active-mode {
            background-image: url('images/BG2.png');
        }

        /* --- 位置控制：坐标修改 --- */
        /* 右上角幸运币 */
        .coin-box { 
            position: absolute; 
            top: 16px;    /* 距离顶部位置 */
            right: 337px;  /* 距离右侧位置 */
            display: flex; align-items: center; gap: 15px; font-size: 38px; 
        }
        .icon-coin { width: 80px; height: 80px; background: url('images/coin_icon.png') no-repeat center/contain; }
        
        /* 左下角碎片 */
        .frag-box { 
            position: absolute; 
            bottom: 60px; /* 距离底部位置 */
            left: 150px;   /* 距离左侧位置 */
            display: flex; align-items: center; gap: 15px; font-size: 28px; 
        }
        .icon-frag { width: 70px; height: 70px; background: url('images/frag_icon.png') no-repeat center/contain; }
        
        #v-frag { color: #000000; font-weight: bold; font-size: 45px; }

        /* 星星位置：由于屏幕变宽，left/right 比例调小一点 */
        .stars-panel {
            position: absolute; top: 50%; transform: translateY(-50%);
            display: none; flex-direction: column; align-items: center; gap: 20px;
        }
        .stars-left { left: 8%; }  /* 控制左星位置 */
        .stars-right { right: 8%; } /* 控制右星位置 */
        
        .star-item {
            width: 70px; height: 70px; /* 星星大小控制 */
            background: url('images/star_icon.png') no-repeat center/contain;
            opacity: 0.2; transition: 0.3s;
        }
        .star-item.active { opacity: 1; filter: drop-shadow(0 0 15px var(--gold)); }

        /* 转盘位置 */
        #wheel-wrap {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            display: none;
        }
        #wheel-img {
            width: 700px; height: 700px; /* 转盘大小控制 */
            background: url('images/wheel.png') no-repeat center/contain;
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
        }

        /* 按钮组位置 */
        .action-group {
            position: absolute; 
            bottom: 100px; /* 按钮组距离底部 */
            right: 80px;  /* 按钮组距离右侧 */
            display: grid; grid-template-areas: "claim claim" "norm prot"; gap: 25px;
        }
        .btn {
            width: 280px; height: 110px; /* 按钮大小控制 */
            background: url('images/btn_bg.png') no-repeat center/100% 100%;
            border: none; cursor: pointer; color: white;
            font-family: inherit; font-size: 32px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
        }
        #btn-claim { grid-area: claim; width: 1200px; font-size: 40px; color: var(--gold); }

        #btn-start {
            position: absolute; bottom: 80px; right: 80px;
            width: 1222px; height: 80px;
            background: url('images/btn_bg.png') no-repeat center/100% 100%;
            border: none; color: #fff; font-size: 42px; font-weight: bold; cursor: pointer;
            font-family: inherit;
        }

        /* 奖励弹窗 */
        #reward-modal {
            display: none; position: absolute; inset: 0; background: rgba(0,0,0,0.85);
            z-index: 100; justify-content: center; align-items: center;
        }
        .reward-box {
            width: 1000px; height: 700px;
            background: url('images/reward_bg.png') no-repeat center/contain;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="game-stage">
    <div class="coin-box"><div class="icon-coin"></div><span id="v-coin">0</span><button onclick="addCoin()">+</button></div>
    <div class="frag-box"><div class="icon-frag"></div><span id="v-frag">0</span></div>
    <div class="stars-panel stars-left" id="panel-l"><div class="star-list" id="list-l"></div></div>
    <div class="stars-panel stars-right" id="panel-r"><div class="star-list" id="list-r"></div></div>
    <div id="wheel-wrap"><div id="wheel-img"></div></div>
    <div id="btn-group" class="action-group" style="display:none;">
        <button id="btn-claim" class="btn" onclick="claim()">领取奖励</button>
        <button class="btn" onclick="append(false)">普通追加</button>
        <button id="btn-prot-text" class="btn" onclick="append(true)">保护追加</button>
    </div>
    <button id="btn-start" onclick="startPlay()">启动抽奖</button>
    <div id="reward-modal"><div class="reward-box"><h1 style="color:var(--gold); font-size:60px;">恭喜获得</h1><div id="reward-val" style="font-size:80px; margin:40px 0;"></div><button class="btn" onclick="closeModal()">收下</button></div></div>
</div>

<script>
    // JS 逻辑完全保持不变，确保功能性
    let coin = 0, frag = 0, lvl = 0, pf = 0, rolling = false;
    const costs = { 1: 6, 2: 17, 3: 51, 4: 153, 5: 430, 6: 827 };
    const rewards = { 1: 12, 2: 36, 3: 108, 4: 324, 5: 972, 6: 2916, 7: 8640 };

    function init() {
        const l = document.getElementById('list-l'), r = document.getElementById('list-r');
        l.innerHTML = r.innerHTML = '';
        for(let i=0; i<7; i++) {
            l.innerHTML += '<div class="star-item"></div>';
            r.innerHTML += '<div class="star-item"></div>';
        }
    }

    // 屏幕适配缩放函数
    function autoScale() {
        const stage = document.getElementById('game-stage');
        const scale = Math.min(window.innerWidth / 2556, window.innerHeight / 1179);
        stage.style.transform = `scale(${scale})`;
    }

    function update() {
        document.getElementById('v-coin').innerText = coin;
        document.getElementById('v-frag').innerText = frag;
        const sL = document.querySelectorAll('#list-l .star-item');
        const sR = document.querySelectorAll('#list-r .star-item');
        sL.forEach((s, i) => i < lvl ? s.classList.add('active') : s.classList.remove('active'));
        sR.forEach((s, i) => i < lvl ? s.classList.add('active') : s.classList.remove('active'));

        const stage = document.getElementById('game-stage');
        if (lvl > 0) {
            stage.classList.add('active-mode');
            document.getElementById('btn-start').style.display = 'none';
            document.getElementById('btn-group').style.display = 'grid';
            document.getElementById('wheel-wrap').style.display = 'block';
            document.getElementById('panel-l').style.display = 'flex';
            document.getElementById('panel-r').style.display = 'flex';
        } else {
            stage.classList.remove('active-mode');
            document.getElementById('btn-start').style.display = 'block';
            document.getElementById('btn-group').style.display = 'none';
            document.getElementById('wheel-wrap').style.display = 'none';
            document.getElementById('panel-l').style.display = 'none';
            document.getElementById('panel-r').style.display = 'none';
        }
        if(lvl > 0 && lvl < 7) document.getElementById('btn-prot-text').innerText = `保护追加(${costs[lvl]})`;
    }

    function addCoin() { let n = prompt("数量:"); if(n) { coin += parseInt(n); update(); } }
    function startPlay() {
        if(rolling) return; rolling = true;
        document.getElementById('wheel-img').style.transform = `rotate(${Math.floor(Math.random()*360) + 2160}deg)`;
        setTimeout(() => { let r = Math.random()*100; lvl = r<1?3:(r<18?2:1); rolling = false; update(); }, 4000);
    }
    function append(isP) {
        if(rolling) return;
        if(isP) {
            if(coin < costs[lvl]) return;
            coin -= costs[lvl]; pf++;
            if(pf >= 3 || Math.random() < 0.2) { lvl += 1; pf = 0; }
        } else {
            if(Math.random() < 0.2) { lvl += 1; }
            else { lvl = Math.max(0, lvl - 1); claim(); return; }
        }
        if(lvl >= 7) { lvl = 7; update(); setTimeout(claim, 800); }
        update();
    }
    function claim() {
        let a = rewards[lvl] || 2; frag += a;
        document.getElementById('reward-val').innerText = `${a} 碎片`;
        document.getElementById('reward-modal').style.display = 'flex';
    }
    function closeModal() { document.getElementById('reward-modal').style.display = 'none'; lvl = 0; pf = 0; update(); }

    window.addEventListener('resize', autoScale);
    init();
    update();
    autoScale();
</script>
</body>
</html>